<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KI-Tools Review - Swipe App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .card-swipe { transition: transform 0.3s ease, opacity 0.3s ease; }
    .card-swipe.swiping { transition: none; }
    .overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; font-weight: bold; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
    .overlay.show { opacity: 1; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    const { useState, useEffect, useRef } = React;

    // ==========================================
    // üîß HIER DEINE EINSTELLUNGEN EINTRAGEN:
    // ==========================================
    const CONFIG = {
      ENDPOINT_LIST: 'http://72.60.135.217:5678/webhook/tools-inbox',
      ENDPOINT_DECIDE: 'http://72.60.135.217:5678/webhook/tools-decision',
      TOKEN: 'eugen33!'
    };
    // ==========================================

    function Card({ item, onAction }) {
      const cardRef = useRef(null);
      const [isDragging, setIsDragging] = useState(false);
      const [startX, setStartX] = useState(0);
      const [offsetX, setOffsetX] = useState(0);
      const [overlayType, setOverlayType] = useState(null);

      const handleStart = (clientX) => {
        setIsDragging(true);
        setStartX(clientX);
      };

      const handleMove = (clientX) => {
        if (!isDragging) return;
        const diff = clientX - startX;
        setOffsetX(diff);
        
        if (diff > 50) setOverlayType('approve');
        else if (diff < -50) setOverlayType('reject');
        else setOverlayType(null);
      };

      const handleEnd = () => {
        if (!isDragging) return;
        setIsDragging(false);

        if (offsetX > 100) {
          onAction('right');
        } else if (offsetX < -100) {
          onAction('left');
        }
        
        setOffsetX(0);
        setOverlayType(null);
      };

      const rotation = offsetX / 20;
      const opacity = 1 - Math.abs(offsetX) / 300;

      return (
        <div
          ref={cardRef}
          className={`card-swipe ${isDragging ? 'swiping' : ''}`}
          style={{
            transform: `translateX(${offsetX}px) rotate(${rotation}deg)`,
            opacity: opacity,
            cursor: isDragging ? 'grabbing' : 'grab'
          }}
          onMouseDown={(e) => handleStart(e.clientX)}
          onMouseMove={(e) => handleMove(e.clientX)}
          onMouseUp={handleEnd}
          onMouseLeave={handleEnd}
          onTouchStart={(e) => handleStart(e.touches[0].clientX)}
          onTouchMove={(e) => handleMove(e.touches[0].clientX)}
          onTouchEnd={handleEnd}
        >
          <div className="bg-white rounded-3xl shadow-2xl p-8 relative select-none max-w-md mx-auto">
            {/* Overlays */}
            <div className={`overlay ${overlayType === 'approve' ? 'show' : ''}`} style={{color: '#22c55e'}}>‚úì</div>
            <div className={`overlay ${overlayType === 'reject' ? 'show' : ''}`} style={{color: '#ef4444'}}>‚úó</div>

            {/* Content */}
            <div className="space-y-4">
              <h2 className="text-3xl font-bold text-gray-900">{item.name}</h2>
              
              <div className="flex gap-2 flex-wrap">
                <span className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                  {item.kategorie}
                </span>
                <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                  {item.kosten}
                </span>
                {item.relevanz && (
                  <span className="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">
                    ‚≠ê {item.relevanz}
                  </span>
                )}
              </div>

              <p className="text-gray-700 text-lg leading-relaxed min-h-[80px]">
                {item.kurzbeschreibung || 'Keine Beschreibung verf√ºgbar'}
              </p>

              <a 
                href={item.link} 
                target="_blank" 
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 font-medium"
                onClick={(e) => e.stopPropagation()}
              >
                üîó Website √∂ffnen
              </a>

              {item.datum && (
                <div className="text-sm text-gray-500 pt-2 border-t">
                  üìÖ {new Date(item.datum).toLocaleDateString('de-DE')}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [items, setItems] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [busy, setBusy] = useState(false);
      const [toast, setToast] = useState('');

      const load = async () => {
        setLoading(true);
        setError(null);
        try {
          const res = await fetch(CONFIG.ENDPOINT_LIST);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          setItems(Array.isArray(data) ? data : []);
        } catch (e) {
          setError(e.message);
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => { load(); }, []);

      const shift = () => setItems(prev => prev.slice(1));

      const act = async (direction, item) => {
        setBusy(true);
        try {
          const res = await fetch(CONFIG.ENDPOINT_DECIDE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              id: item.id, 
              action: direction === 'right' ? 'approve' : 'reject', 
              token: CONFIG.TOKEN 
            })
          });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const msg = direction === 'right' ? '‚úÖ √úbernommen' : '‚ùå Abgelehnt';
          setToast(`${item.name} ‚Äì ${msg}`);
          setTimeout(() => setToast(''), 2000);
        } catch (e) {
          setToast(`‚ö†Ô∏è Fehler: ${e.message}`);
          setItems(prev => [item, ...prev]);
        } finally {
          setBusy(false);
        }
      };

      const onAction = (direction) => {
        const current = items[0];
        shift();
        act(direction, current);
      };

      useEffect(() => {
        const h = (e) => {
          if (!items[0]) return;
          if (e.key === 'ArrowLeft') onAction('left');
          if (e.key === 'ArrowRight') onAction('right');
          if (e.key === ' ') {
            e.preventDefault();
            window.open(items[0].link, '_blank');
          }
        };
        window.addEventListener('keydown', h);
        return () => window.removeEventListener('keydown', h);
      }, [items]);

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4">
          <div className="w-full max-w-2xl space-y-6">
            {/* Header */}
            <header className="flex items-center justify-between px-4">
              <h1 className="text-3xl font-bold text-gray-900">ü§ñ KI-Tools Review</h1>
              <div className="flex items-center gap-3">
                <div className="text-sm text-gray-600">
                  {busy ? '‚è≥ Sync...' : items.length > 0 ? `${items.length} Tools` : 'Bereit'}
                </div>
                <button 
                  onClick={load}
                  className="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm"
                >
                  üîÑ
                </button>
              </div>
            </header>

            {/* Loading & Error */}
            {loading && (
              <div className="text-center text-gray-600 py-12">
                <div className="text-4xl mb-2">‚è≥</div>
                Lade Tools...
              </div>
            )}
            
            {error && (
              <div className="bg-red-50 border border-red-200 rounded-2xl p-6 text-center">
                <div className="text-red-600 font-medium">‚ö†Ô∏è Fehler beim Laden</div>
                <div className="text-red-500 text-sm mt-2">{String(error)}</div>
                <button 
                  onClick={load}
                  className="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
                >
                  Erneut versuchen
                </button>
              </div>
            )}

            {/* Empty State */}
            {!loading && items.length === 0 && !error && (
              <div className="bg-white rounded-2xl shadow-lg p-8 text-center space-y-4">
                <div className="text-6xl">üéâ</div>
                <div className="text-xl font-medium text-gray-900">Keine offenen Tools!</div>
                <div className="text-gray-600">Alle Tools wurden bereits reviewt.</div>
                <button 
                  onClick={load}
                  className="px-6 py-3 bg-gray-900 text-white rounded-xl hover:bg-gray-800"
                >
                  Neu laden
                </button>
              </div>
            )}

            {/* Cards Stack */}
            {items.length > 0 && (
              <div className="relative" style={{ minHeight: '500px' }}>
                {items.slice(0, 3).map((item, idx) => (
                  <div 
                    key={item.id} 
                    className="absolute inset-0"
                    style={{ 
                      zIndex: 100 - idx,
                      transform: idx === 0 ? 'none' : idx === 1 ? 'scale(0.95) translateY(10px)' : 'scale(0.9) translateY(20px)',
                      opacity: idx === 0 ? 1 : 0.7,
                      transition: 'transform 0.3s ease, opacity 0.3s ease'
                    }}
                  >
                    {idx === 0 ? (
                      <Card item={item} onAction={onAction} />
                    ) : (
                      <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md mx-auto">
                        <div className="text-gray-400 text-center text-lg">{item.name}</div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}

            {/* Controls */}
            {items.length > 0 && (
              <div className="flex items-center justify-between px-4">
                <div className="text-sm text-gray-500">
                  üí° Tipp: Wischen, Pfeiltasten (‚Üê/‚Üí) oder Leertaste f√ºr Link
                </div>
                <div className="flex gap-3">
                  <button 
                    onClick={() => onAction('left')}
                    className="w-14 h-14 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-2xl shadow-lg"
                    disabled={busy}
                  >
                    ‚ùå
                  </button>
                  <button 
                    onClick={() => onAction('right')}
                    className="w-14 h-14 rounded-full bg-green-500 hover:bg-green-600 flex items-center justify-center text-2xl shadow-lg"
                    disabled={busy}
                  >
                    ‚úÖ
                  </button>
                </div>
              </div>
            )}

            {/* Toast */}
            {toast && (
              <div className="fixed bottom-8 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl z-50 animate-bounce">
                {toast}
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
